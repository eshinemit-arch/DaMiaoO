# DaMiaoo Pro Max \\ 演示文稿自动化引擎

DaMiaoo 是一个基于 Markdown 和 Marp 的现代化、自动化的演示文稿（PPT/PDF/HTML）生成系统。它专为追求 **“内容效率”** 与 **“视觉高度”** 完美平衡的用户设计，基于独创的 **UI/UX Pro Max** 视觉规范。让您只需专注于编写纯粹的 Markdown 知识脉络，系统便自动将其转化为极具设计感、呼吸感和逻辑张力的专业幻灯片。

---

## 🌟 核心特性 (Core Features)

- **🤖 零标记语义识别 (Zero-Markup Inference)**：您完全可以像写博客一样写文档，不加任何排版标签。引擎会通过文本提权分析层级（H1/H2/H3），通过关键词、图片、引用和列表数量，智能分配 `@chapter`、`@cols`、`@metric` 等最佳黄金版式。
- **⚙️ 动态内容扩容与排版进化 (Layout Evolution)**：内置“语义切刀”。当幻灯片文字超载或列表过多时，系统会自动进行智能分页与上下文截断（并加上“续”字标）。更强大的是，被切分的子页面会根据剩余内容数量**动态降级或进化**（例如从 `cols5` 进化为流式的 `cards` 矩阵），彻底告别大面积留白的尴尬。
- **🛡️ 结构完整性保护**：代码块被视为“神圣原子”。即使内部包含空行或 `#` 注释，排版引擎也绝不从中间截断代码，且注释不会干扰全局目录层级提取。
- **🧹 智能前言剥离 (Preamble Stripping)**：为文档而生的 Markdown 往往带有长篇介绍。DaMiaoo 会自动识别首个 `#` (Rank 1) 作为幻灯片主标题，并**智能剥离**在此之前的文档级导言，让演示文稿上来就直入主题。
- **✨ 细节语义清洗**：告别排版毛刺。支持使用 `\\` 在标题或致谢中执行优雅的“物理换行”；自动抹除多列版式（Cards/Cols）中小标题后累赘的冒号间隔符。
- **🎨 UI/UX Pro Max 视觉体系**：内置极致的 `theme-damiaoo.css` 主题，采用非对称网格、深色沉浸式章节卡片、黄金分割比例和电影级视觉张力。
- **📊 自动化成果审计**：每次构建都会输出《成果质量审计报告》，包含全案规格、平均文字密度、版式分布矩阵，健康状态一目了然。

---

## 🏗 双擎架构说明

DaMiaoo 引擎包含两个可独立工作也可深度串联的核心模块：

### 1. 预处理器 (Preprocessor: `damiaoo-preprocessor.js`)

**“聪明的排版大脑”**
直接接收用户的原始 Markdown，通过语义识别自动补全排版标签，生成目录、实施高密度切分、保护代码块，并输出“携带排版指令”的中间态 `.process_xxx.md`。

### 2. 编译器 (Compiler: `damiaoo-compiler.js`)

**“忠实的级联翻译桥梁”**
负责将中间态 Markdown 精准翻译为 Marp 级联 HTML/CSS。

- **动静分离**：过滤 Markdown 配置块，保障元数据安全。
- **系统页兜底**：智能注入封面 (`@[front]`) 和封底 (`@[back]`)，并完成 `\\` 物理换行符到 HTML `<br>` 的渲染转义。

### 3. 构建总线 (Builder: `builder.js`)

总入口文件，无缝串联 Preprocessor 和 Compiler，提供一键黑盒生成体验。

---

## 🚀 快速开始

### 1. 编写源 Markdown

创建一个 `presentation.md`。只要结构清晰，无需任何排版指令：

```markdown
---
marp: true
theme: damiaoo
author: "DaMiaoo Team"
thanks: "感谢聆听 \\ 期待交流"
---

# 2026 年度智能产品 \\ 全球发布会

这段文字是文档引言，在排版为 PPT 时会被自动剥离，以保持开场简洁。

---
## 极速起步优势
- **效率提升**：自动化排版节省 90% 时间。
- **视觉统一**：杜绝个人审美差异造成的排版灾难。
- **跨平台**：一次编写，PDF/HTML/PPTX 多端输出。
```

### 2. 一键构建

进入项目目录，运行以下命令进行快速构建：

```bash
# 默认全自动构建 (智能排版 + 纯净渲染)，输出高质量 PDF
node builder.js -p -c presentation.md --pdf

# 仅执行预处理（生成中间件 .process_presentation.md 供专家级微调）
node builder.js -p presentation.md

# 仅执行编译（跳过智能排版，直接渲染您修改过的中间件）
node builder.js -c .process_presentation.md --pdf
```

---

## 🏷️ 核心版式标签说明

虽然引擎主推**“零标记推断”**，但在专家模式下，您可以在 Markdown 中使用 `@[...]` 强制锁定特定版式，接管自动引擎的控制权。

### 📌 基础结构

- **`@[front]`**：自动封面。提取 Metadata 中的 `title`, `author`, `date`。会自动将 `\\` 渲染为两行。
- **`@[back]`**：自动封底。提取 Metadata 中的 `thanks`。同样支持 `\\` 换行。
- **`@[toc]`** 或 **`@[toc:4]`**：自动生成的全局目录。带编号后缀可强行设定起始序号列表。
- **`@[chapter]`**：章节过渡页。深色沉浸卡片，自带呼吸感，适用于结构承上启下。

### 📌 增强版式

- **`@[split]`**：黄金分割异步图文。一侧为文字呼吸区，一侧为原质全幅图片（当幻灯片中只有极少量文字和一张图片时自动触发）。
- **`@[focus]`**：单点视域对焦页。正文居中、放大加粗，去除界面杂色，适用于“口号”、“结论”、“金句”的提纯展示。
- **`@[metric]`**：万倍核心指标页。超大屏数字，极具压迫感，适合展示诸如财报百分比、转化率等震撼数据。
- **`@[quote]`**：杂志级深度共鸣语录。带有左侧引言装饰条，具有高度的设计高级感。

### 📌 知识矩阵 (业务分栏)

- **`@[cols2]`** 到 **`@[cols6]`**：多列等宽网格布局。引擎会根据您写入的无序/有序列表数量，自动挑选最佳列数；如果条目超载被分页拆解，系统会自动针对余量条目进行降级（例如 10 条内容：一页 cols5，下一页 cols5；7 条内容：一页 cols5，第二页降级为 cols2）。
- **`@[cards]`**：流式动态卡片矩阵。适合内容更丰富、带有小标题的长文本。自动处理 3xN 排版，并同样支持超载排版进化。

---

## 💡 最佳实践与避坑指南 (Tips)

1. **手动换行控制**：对封面的长标题不满意？在 `title: "主标 \\ 副标"` 之间加入 `\\`。
2. **防切割保护**：引擎采用“防误杀”机制。如果某页因为业务过于复杂，出现了混合列表和小段落，系统会主动将其拆解。如果这不符合您的意图，请手动在一开始加上 `@[cols3]` 强行锁定排版。
3. **消除毛刺**：在卡片设计中，习惯写 `- **核心点**: 这是详细解释`。引擎会自动帮您把中间那个丑陋的冒号 `:` 剥离干净，渲染出一张漂亮的深色悬浮卡片。
4. **元数据声明**：请确保文档最上方的 Frontmatter 区块被 `---` 严密包裹，否则引擎可能无法提取正确属性并会抛出兜底文本。

---

## 🐳 Docker 无暇部署

为了解决环境依赖缺失（如没有全局 Node 环境或运行 Marp 所需的 Chromium 引擎），我们提供了极简的 Docker 封装方案。详见 **[Docker 部署指南](./DOCKER.md)**，实现“一次镜像，四海运行”。

---

> _**DaMiaoo 诞生于对“粗糙罗列表达”的极致反叛。技术人的分享，理应兼具理性之骨与感性之美。**_
