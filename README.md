# DaMiaoo Pro Max 演示文稿自动化引擎

DaMiaoo 是一个基于 Markdown 和 Marp 的现代化、自动化的演示文稿（PPT/PDF/HTML）生成系统。它专为追求 **“内容效率”** 与 **“视觉高度”** 完美平衡的用户设计，内置 UI/UX Pro Max 视觉规范，让您只需专注于编写 Markdown 内容，系统将自动把纯文本转化为极具设计感的专业幻灯片。

---

## 🌟 核心特性

- **🤖 语义智能预处理**：自动分析文本层级（H1/H2/H3），智能识别页面类型。
- **⚙️ 动态内容扩容与分页**：内置“语义切刀”，自动检测内容密度。当幻灯片文字超载（>250字）或卡片/列表过多时，系统会自动进行智能分页与上下文截断，确保每页保持呼吸感。
- **🎨 UI/UX Pro Max 视觉规范**：内置 `theme-damiaoo.css` 极致主题，采用非对称网格、黄金分割比例、大面积留白和沉浸式排版。
- **📊 自动化成果审计**：每次构建都会输出《成果质量审计报告》，包含全案规格、平均文字密度、版式分布矩阵。
- **🛠 双擎架构**：预处理器（智能排版）与编译器（忠实翻译）分离，支持全自动流水线，也支持专家级的手动微调。

---

## 🏗 架构说明

DaMiaoo 引擎包含两个可独立工作也可深度串联的核心模块：

### 1. 预处理器 (Preprocessor: `damiaoo-preprocessor.js`)

**“聪明的排版大脑”**
直接接收用户的原始 Markdown，通过语义识别自动补全排版标签（如检测到 5 项无序列表自动套用 `@[cols5]`；检测到大写数字自动套用 `@[metric]`）。同时负责生成目录、拆分长页，并输出中间态的 `.compiled_xxx.md`。

### 2. 编译器 (Compiler: `damiaoo-compiler.js`)

**“忠实的翻译桥梁”**
（专家模式）负责将带有 DaMiaoo 标签的 Markdown 精准翻译为 Marp 级联 HTML/CSS 代码。

- **动静分离**：自动过滤 Markdown 配置块，防止 metadata（如 author）被误渲染为普通文本。
- **智能兜底**：如果封面/封底未指定内容，自动从 Frontmatter 中提取并完美呈现。

### 3. 构建总线 (Builder: `builder.js`)

总入口文件，串联 Preprocessor 和 Compiler，提供一键生成体验。

---

## 🚀 快速开始

### 1. 编写 Markdown

创建一个 `presentation.md` 文件，并在文件头部添加 Frontmatter 配置：

```markdown
---
marp: true
theme: damiaoo
title: "我的年度汇报"
author: "产品经理"
date: "2026年Q4"
thanks: "感谢聆听，期待交流！"
paginate: true
---

# 我们的愿景
用技术重塑表达。
```

### 2. 运行构建 (dm 简化版)

进入引擎目录，使用内置的 `dm` 命令快速构建：

```bash
# 默认全自动构建 (Preprocess + Compile)，生成 PPTX
dm presentation.md

# 手动指定阶段（生成 HTML）
dm -p -c presentation.md --html

# 仅执行预处理（生成中间件供微调）
dm -p presentation.md

# 仅执行编译（直接渲染已有中间件）
dm -c .process_presentation.md --pdf
```

## 3. 命令详解

`dm` 是 DaMiaoo 的主入口命令，支持以下参数：

- `-p, --preprocess`: 执行语义分析、智能排版和结构分页。
- `-c, --compile`: 执行 Marp 渲染，将标准 Markdown 导出为目标格式。
- `--html / --pdf / --pptx`: 指定输出格式。
- `-h, --help`: 查看完整帮助信息。

---

## 🐳 Docker 部署

为了解决环境依赖（如 Chromium）并实现一次构建到处运行，您可以参考 **[Docker 部署指南](./DOCKER.md)**。

---

## 🏷️ 核心版式标签语法

DaMiaoo 抽象了一套极简的 `@[]` 标签系统。在预处理器模式下，许多标签会被自动推断和插入。如果需要手动控制，可以在 `---` 分页符后写入。

### 📌 基础结构

- **`@[front]`**：自动封面。提取 `title`, `author`, `date`。支持覆写。
- **`@[back]`**：自动封底。提取 `thanks`。支持覆写。
- **`@[toc]`** 或 **`@[toc:4]`**：自动生成的目录。带冒号后缀代表强行设定该页的目录序号起点（用于复杂多页目录编排）。
- **`@[chapter]`**：章节过渡页，使用深色沉浸卡片彰显层级。

### 📌 强化版式

- **`@[split]`**：图文异步网格。采用 `1fr 1.1fr` 黄金分割，左侧为文字呼吸区，右侧为全幅配图流（当幻灯片内出现独立图片时会自动触发）。
- **`@[metric]`**：万倍冲击核心指标页。超大字号，将数据（如百分比、金额）最大化冲击听众视觉。
- **`@[quote]`**：杂志级深度共鸣排版，带有引言装饰，适合愿景陈述。
- **`@[focus]`**：单点强调页，标题居中且被加粗放大，去除多余干扰。

### 📌 知识矩阵 (多维网格)

- **`@[cols2]`** 到 **`@[cols6]`**：自动横向排列的多列网格系统。预处理器会自动根据您的无序列表数量锁定最合适的 cols。
- **`@[cards]`**：流式复杂卡片。适合长文本列表段落。当卡片内容密度过高，预处理器会自动对齐并溢出拆页（比如分页限额 6 张卡片）。

---

## 💡 开发与调试 (Tips)

1. **配置不生效？**：请检查第一页以上的 Frontmatter 是否用 `---` 严密包裹，DaMiaoo 需要通过此区域提取 Metadata。
2. **想保留某页内容不被自动拆分？**：当前预处理器采用“防误杀机制”。如果某页内容过杂，它会提示“存在混合排版结构”并拆解，建议手动利用 `@[...]` 标签强制锁定特定版式。
3. **想换主题？**：在 Frontmatter 中修改 `theme: nature`，系统将自动定位 `theme-nature.css` 进行渲染。

---

## 🤝 贡献与支持

DaMiaoo 诞生于对“粗糙罗列”的反叛。欢迎提交 Issue 或优化您的专属 CSS 设计规范并扩展 `builder.js` 的排版想象力。
